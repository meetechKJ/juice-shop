name: OWASP ZAP Full Scan

on:
  push:
    branches: [ main, develop, master ]
  pull_request:
    branches: [ main, master ]
  schedule:
    - cron: '0 0 * * 0' # æ¯Žé€±æ—¥æ›œæ—¥ã«å®Ÿè¡Œ

jobs:
  zap_scan:
    runs-on: ubuntu-latest
    steps:
      - name: ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v3

      - name: Juice Shopã®Dockerã‚³ãƒ³ãƒ†ãƒŠã‚’èµ·å‹•
        run: |
          docker run -d -p 3000:3000 --name juice-shop bkimminich/juice-shop
          sleep 20 # ã‚³ãƒ³ãƒ†ãƒŠã®èµ·å‹•ã‚’å¾…æ©Ÿ

      - name: OWASP ZAP ãƒ•ãƒ«ã‚¹ã‚­ãƒ£ãƒ³ã‚’å®Ÿè¡Œ
        uses: zaproxy/action-full-scan@v0.3.0
        with:
          target: 'http://localhost:8080'
          fail_action: false
          cmd_options: '-I'

      - name: ã‚¹ã‚­ãƒ£ãƒ³çµæžœã‚’è§£æž
        run: |
          HIGH_COUNT=$(grep -c "High" zap_scan.log || echo 0)
          MEDIUM_COUNT=$(grep -c "Medium" zap_scan.log || echo 0)
          LOW_COUNT=$(grep -c "Low" zap_scan.log || echo 0)
          INFO_COUNT=$(grep -c "Info" zap_scan.log || echo 0)

      - name: ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½œæˆ
        run: |
          echo "## OWASP ZAP ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒãƒ¼ãƒˆ" >> $GITHUB_STEP_SUMMARY
          echo "| è„†å¼±æ€§ãƒ¬ãƒ™ãƒ« | æ¤œå‡ºæ•° |" >> $GITHUB_STEP_SUMMARY
          echo "|-------------|--------|" >> $GITHUB_STEP_SUMMARY
          echo "| ðŸ”´ High      | $HIGH_COUNT |" >> $GITHUB_STEP_SUMMARY
          echo "| ðŸŸ¡ Medium    | $MEDIUM_COUNT |" >> $GITHUB_STEP_SUMMARY
          echo "| ðŸŸ¢ Low       | $LOW_COUNT |" >> $GITHUB_STEP_SUMMARY
          echo "| â„¹ï¸ Info      | $INFO_COUNT |" >> $GITHUB_STEP_SUMMARY
          echo "| **Total**    | $((HIGH_COUNT + MEDIUM_COUNT + LOW_COUNT + INFO_COUNT)) |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ðŸ” è‡ªå‹•è¨ºæ–­å®Œäº†ï¼è©³ç´°ãªãƒ¬ãƒãƒ¼ãƒˆã¯ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚" >> $GITHUB_STEP_SUMMARY
